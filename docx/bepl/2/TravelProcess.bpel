<!-- TravelProcess BPEL Process [Generated by the Eclipse BPEL Designer] -->
<!-- Date: Thu May 19 09:24:34 CST 2016 -->
<bpel:process name="TravelProcess" targetNamespace="http://sample.bpel.org/bpel/sample"
	suppressJoinFailure="yes" xmlns:tns="http://sample.bpel.org/bpel/sample"
	xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
	xmlns:ns1="http://spot.example.ws" xmlns:ns2="http://hotel.example.ws"
	xmlns:ns3="http://airline.example.ws" xmlns:ns4="http://rentalCar.example.ws">

	<!-- Import the client WSDL -->
	<bpel:import namespace="http://rentalCar.example.ws"
		location="RentalCarService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import namespace="http://airline.example.ws"
		location="AirlineService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import namespace="http://hotel.example.ws" location="HotelService.wsdl"
		importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import namespace="http://spot.example.ws" location="SpotService.wsdl"
		importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import location="TravelProcessArtifacts.wsdl"
		namespace="http://sample.bpel.org/bpel/sample" importType="http://schemas.xmlsoap.org/wsdl/" />

	<!-- ================================================================= -->
	<!-- PARTNERLINKS -->
	<!-- List of services participating in this BPEL process -->
	<!-- ================================================================= -->
	<bpel:partnerLinks>
		<!-- The 'client' role represents the requester of this service. -->
		<bpel:partnerLink name="client" partnerLinkType="tns:TravelProcess"
			myRole="TravelProcessProvider" />

		<bpel:partnerLink name="spotPL" partnerLinkType="tns:spotPLT"
			partnerRole="spotProvider"></bpel:partnerLink>
		<bpel:partnerLink name="hotelPL" partnerLinkType="tns:hotelPLT"
			partnerRole="hotelProvider"></bpel:partnerLink>
		<bpel:partnerLink name="airlinePL" partnerLinkType="tns:airlinePLT"
			partnerRole="airlineProvider"></bpel:partnerLink>
		<bpel:partnerLink name="rentalCarPL" partnerLinkType="tns:rentalCarPLT"
			partnerRole="rentalCarProvider"></bpel:partnerLink>
	</bpel:partnerLinks>

	<!-- ================================================================= -->
	<!-- VARIABLES -->
	<!-- List of messages and XML documents used within this BPEL process -->
	<!-- ================================================================= -->
	<bpel:variables>
		<!-- Reference to the message passed as input during initiation -->
		<bpel:variable name="input" messageType="tns:TravelProcessRequestMessage" />

		<!-- Reference to the message that will be returned to the requester -->
		<bpel:variable name="output" messageType="tns:TravelProcessResponseMessage" />

		<bpel:variable name="spotRequest" messageType="ns1:getSpotRequest"></bpel:variable>
		<bpel:variable name="spotResponse" messageType="ns1:getSpotResponse"></bpel:variable>
		<bpel:variable name="tourRequest" messageType="ns1:getTourRequest"></bpel:variable>
		<bpel:variable name="tourResponse" messageType="ns1:getTourResponse"></bpel:variable>
		<bpel:variable name="hotelRequest" messageType="ns2:getHotelRequest"></bpel:variable>
		<bpel:variable name="hotelResponse" messageType="ns2:getHotelResponse"></bpel:variable>
		<bpel:variable name="airlineRequest" messageType="ns3:getAirlineRequest"></bpel:variable>
		<bpel:variable name="airlineResponse" messageType="ns3:getAirlineResponse"></bpel:variable>
		<bpel:variable name="rentalCarRequest" messageType="ns4:getRentalCarRequest"></bpel:variable>
		<bpel:variable name="rentalCarResponse" messageType="ns4:getRentalCarResponse"></bpel:variable>
		<bpel:variable name="hotelPriceRequest" messageType="ns2:getHotelPriceRequest"></bpel:variable>
		<bpel:variable name="hotelPriceResponse" messageType="ns2:getHotelPriceResponse"></bpel:variable>
		<bpel:variable name="ticketPriceRequest" messageType="ns3:getTicketPriceRequest"></bpel:variable>
		<bpel:variable name="ticketPriceResponse" messageType="ns3:getTicketPriceResponse"></bpel:variable>
		<bpel:variable name="rentalCarPriceRequest" messageType="ns4:getRentalCarPriceRequest"></bpel:variable>
		<bpel:variable name="rentalCarPriceResponse"
			messageType="ns4:getRentalCarPriceResponse"></bpel:variable>
	</bpel:variables>

	<!-- ================================================================= -->
	<!-- ORCHESTRATION LOGIC -->
	<!-- Set of activities coordinating the flow of messages across the -->
	<!-- services integrated within this business process -->
	<!-- ================================================================= -->
	<bpel:sequence name="main">

		<!-- Receive input from requester. Note: This maps to operation defined 
			in TravelProcess.wsdl -->
        
        <bpel:receive name="receiveInput" partnerLink="client"
			portType="tns:TravelProcess" operation="process" variable="input"
			createInstance="yes" />
        
        
		

		
        
        
        
        
		<bpel:assign validate="no" name="prepareAirline">
            <bpel:copy>
                <bpel:from><bpel:literal><impl:getTour xmlns:impl="http://spot.example.ws" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <impl:destination>impl:destination</impl:destination>
</impl:getTour>
</bpel:literal></bpel:from>
                <bpel:to variable="tourRequest" part="parameters"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from><bpel:literal><impl:getSpot xmlns:impl="http://spot.example.ws" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <impl:destination>impl:destination</impl:destination>
</impl:getSpot>
</bpel:literal></bpel:from>
                <bpel:to variable="spotRequest" part="parameters"></bpel:to>
            </bpel:copy>
            <bpel:copy>
				<bpel:from>
					<bpel:literal>
						<impl:getTicketPrice xmlns:impl="http://airline.example.ws"
							xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
							<impl:dayGo>impl:dayGo</impl:dayGo>
							<impl:cityFrom>impl:cityFrom</impl:cityFrom>
							<impl:cityTo>impl:cityTo</impl:cityTo>
							<impl:prefE>impl:prefE</impl:prefE>
							<impl:prefP>0.0</impl:prefP>
						</impl:getTicketPrice>
					</bpel:literal>
				</bpel:from>
				<bpel:to variable="ticketPriceRequest" part="parameters"></bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from>
					<bpel:literal xml:space="preserve"><impl:getAirline
						xmlns:impl="http://airline.example.ws" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <impl:dayGo>impl:dayGo</impl:dayGo>
  <impl:cityFrom>impl:cityFrom</impl:cityFrom>
  <impl:cityTo>impl:cityTo</impl:cityTo>
  <impl:prefE>impl:prefE</impl:prefE>
  <impl:prefP>0.0</impl:prefP>
</impl:getAirline>
</bpel:literal>
				</bpel:from>
				<bpel:to part="parameters" variable="airlineRequest">
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:出发时间]]>
					</bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="airlineRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[ns3:dayGo]]>
					</bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:出发城市]]>
					</bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="airlineRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[ns3:cityFrom]]>
					</bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:目的地]]>
					</bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="airlineRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[ns3:cityTo]]>
					</bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:是否经济舱]]></bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="airlineRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[ns3:prefE]]>
					</bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:总预算]]>
                    </bpel:query>
                </bpel:from>
				<bpel:to part="parameters" variable="airlineRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:prefP]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:出发时间]]></bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="ticketPriceRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:dayGo]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:出发城市]]></bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="ticketPriceRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:cityFrom]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:目的地]]></bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="ticketPriceRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:cityTo]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:是否经济舱]]></bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="ticketPriceRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:prefE]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:总预算]]>
                    </bpel:query>
                </bpel:from>
				<bpel:to part="parameters" variable="ticketPriceRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:prefP]]></bpel:query>
				</bpel:to>
			</bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:目的地]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="tourRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[ns1:destination]]>
                    </bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:目的地]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="spotRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[ns1:destination]]>
                    </bpel:query>
                </bpel:to>
            </bpel:copy>
        </bpel:assign>
		<bpel:invoke name="getAirline" partnerLink="airlinePL"
			operation="getAirline" portType="ns3:AirlineService" inputVariable="airlineRequest"
			outputVariable="airlineResponse"></bpel:invoke>
		<bpel:invoke name="getTicketPrice" partnerLink="airlinePL"
			operation="getTicketPrice" portType="ns3:AirlineService"
			inputVariable="ticketPriceRequest" outputVariable="ticketPriceResponse"></bpel:invoke>
		<bpel:assign validate="no" name="subTicketPrice">

			<bpel:copy>
				<bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    <![CDATA[$input.payload/tns:总预算 - $ticketPriceResponse.parameters/ns3:getTicketPriceReturn]]>
				</bpel:from>
				<bpel:to part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:总预算]]></bpel:query>
				</bpel:to>
			</bpel:copy>

		</bpel:assign>
		<bpel:assign validate="no" name="prepareRentalCar">
			<bpel:copy>
				<bpel:from>
					<bpel:literal xml:space="preserve"><impl:getRentalCarPrice
						xmlns:impl="http://rentalCar.example.ws" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <impl:CarType>impl:CarType</impl:CarType>
  <impl:MT_AT>impl:MT_AT</impl:MT_AT>
  <impl:Dep_City>impl:Dep_City</impl:Dep_City>
  <impl:Des_Ctiy>impl:Des_Ctiy</impl:Des_Ctiy>
  <impl:StartUse_Date>impl:StartUse_Date</impl:StartUse_Date>
  <impl:StopUse_Date>impl:StopUse_Date</impl:StopUse_Date>
  <impl:Preference>impl:Preference</impl:Preference>
</impl:getRentalCarPrice>
</bpel:literal>
				</bpel:from>
				<bpel:to variable="rentalCarPriceRequest" part="parameters"></bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from>
					<bpel:literal xml:space="preserve"><impl:getRentalCar
						xmlns:impl="http://rentalCar.example.ws" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <impl:CarType>impl:CarType</impl:CarType>
  <impl:MT_AT>impl:MT_AT</impl:MT_AT>
  <impl:Dep_City>impl:Dep_City</impl:Dep_City>
  <impl:Des_Ctiy>impl:Des_Ctiy</impl:Des_Ctiy>
  <impl:StartUse_Date>impl:StartUse_Date</impl:StartUse_Date>
  <impl:StopUse_Date>impl:StopUse_Date</impl:StopUse_Date>
  <impl:Preference>impl:Preference</impl:Preference>
</impl:getRentalCar>
</bpel:literal>
				</bpel:from>
				<bpel:to variable="rentalCarRequest" part="parameters"></bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:车型]]>
					</bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="rentalCarRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[ns4:CarType]]>
					</bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:是否手动挡]]>
					</bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="rentalCarRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[ns4:MT_AT]]>
					</bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:租车地点]]>
					</bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="rentalCarRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[ns4:Dep_City]]>
					</bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:还车地点]]></bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="rentalCarRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns4:Des_Ctiy]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:返回时间]]>
					</bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="rentalCarRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[ns4:StopUse_Date]]>
					</bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:租车偏好]]></bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="rentalCarRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[ns4:Preference]]>
					</bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:车型]]></bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="rentalCarPriceRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns4:CarType]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:是否手动挡]]></bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="rentalCarPriceRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[ns4:MT_AT]]>
                    </bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:租车地点]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="rentalCarPriceRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns4:Dep_City]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:还车地点]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="rentalCarPriceRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns4:Des_Ctiy]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:出发时间]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="rentalCarPriceRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns4:StartUse_Date]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:返回时间]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="rentalCarPriceRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns4:StopUse_Date]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:租车偏好]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="rentalCarPriceRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns4:Preference]]></bpel:query>
                </bpel:to>
            </bpel:copy>
        </bpel:assign>
		<bpel:invoke name="getRentalCar" partnerLink="rentalCarPL"
			operation="getRentalCar" portType="ns4:RentalCarService" inputVariable="rentalCarRequest" outputVariable="rentalCarResponse"></bpel:invoke>
        <bpel:invoke name="getRentalCarPrice" partnerLink="rentalCarPL" operation="getRentalCarPrice" portType="ns4:RentalCarService" inputVariable="rentalCarPriceRequest" outputVariable="rentalCarPriceResponse"></bpel:invoke>
        <bpel:assign validate="no" name="subRentalCarPrice">
            <bpel:copy>
                <bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">            
                    <![CDATA[$input.payload/tns:总预算 - $rentalCarPriceResponse.parameters/ns4:getRentalCarPriceReturn]]>
                </bpel:from>
                <bpel:to part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:总预算]]>
                    </bpel:query>
                </bpel:to>
            </bpel:copy>
        </bpel:assign>
        <bpel:assign validate="no" name="prepareHotel">
            
            <bpel:copy>
                <bpel:from><bpel:literal><impl:getHotel xmlns:impl="http://hotel.example.ws" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <impl:startDate>impl:startDate</impl:startDate>
  <impl:endDate>impl:endDate</impl:endDate>
  <impl:city>impl:city</impl:city>
  <impl:price>0.0</impl:price>
</impl:getHotel>
</bpel:literal></bpel:from>
                <bpel:to variable="hotelRequest" part="parameters"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from><bpel:literal><impl:getHotelPrice xmlns:impl="http://hotel.example.ws" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <impl:startDate>impl:startDate</impl:startDate>
  <impl:endDate>impl:endDate</impl:endDate>
  <impl:city>impl:city</impl:city>
  <impl:price>0.0</impl:price>
</impl:getHotelPrice>
</bpel:literal></bpel:from>
                <bpel:to variable="hotelPriceRequest" part="parameters"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:出发时间]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="hotelPriceRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns2:startDate]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:返回时间]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="hotelPriceRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns2:endDate]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:目的地]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="hotelPriceRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns2:city]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:总预算]]>
                    </bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="hotelPriceRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns2:price]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:出发时间]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="hotelRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns2:startDate]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:返回时间]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="hotelRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns2:endDate]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:目的地]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="hotelRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns2:city]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:总预算]]>
                    </bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="hotelRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns2:price]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            
            
            
            
        
        
        </bpel:assign>
        <bpel:invoke name="getHotel" partnerLink="hotelPL" operation="getHotel" portType="ns2:HotelService" inputVariable="hotelRequest" outputVariable="hotelResponse"></bpel:invoke>
        <bpel:invoke name="getHotelPrice" partnerLink="hotelPL" operation="getHotelPrice" portType="ns2:HotelService" inputVariable="hotelPriceRequest" outputVariable="hotelPriceResponse"></bpel:invoke>
        <bpel:assign validate="no" name="subHotelPrice"><bpel:copy>
				<bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">       
                    <![CDATA[$input.payload/tns:总预算 - $hotelPriceResponse.parameters/ns2:getHotelPriceReturn]]>
				</bpel:from>
				<bpel:to part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:总预算]]></bpel:query>
				</bpel:to>
			</bpel:copy>
		
        </bpel:assign>
        <bpel:invoke name="getSpot" partnerLink="spotPL"
			operation="getSpot" portType="ns1:SpotService" inputVariable="spotRequest"
			outputVariable="spotResponse"></bpel:invoke>
		<!-- Generate reply to synchronous request -->

		<bpel:invoke name="getTour" partnerLink="spotPL"
			operation="getTour" portType="ns1:SpotService" inputVariable="tourRequest"
			outputVariable="tourResponse"></bpel:invoke>
		<bpel:assign validate="no" name="processOutput">
			<bpel:copy>
				<bpel:from>
                    <bpel:literal xml:space="preserve"><tns:TravelProcessResponse xmlns:tns="http://sample.bpel.org/bpel/sample" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:推荐酒店>tns:推荐酒店</tns:推荐酒店>
  <tns:酒店预算>tns:酒店预算</tns:酒店预算>
  <tns:推荐机票>tns:推荐机票</tns:推荐机票>
  <tns:机票预算>tns:机票预算</tns:机票预算>
  <tns:推荐景点>tns:推荐景点</tns:推荐景点>
  <tns:推荐导游>tns:推荐导游</tns:推荐导游>
  <tns:推荐租车>tns:推荐租车</tns:推荐租车>
  <tns:租车预算>tns:租车预算</tns:租车预算>
  <tns:剩余预算>0.0</tns:剩余预算>
</tns:TravelProcessResponse>
</bpel:literal>
                </bpel:from>
				<bpel:to part="payload" variable="output"></bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="parameters" variable="airlineResponse"> 
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[ns3:getAirlineReturn]]>
                    </bpel:query>
                </bpel:from>
				<bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:推荐机票]]>
                    </bpel:query>
                </bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="parameters" variable="hotelResponse">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[ns2:getHotelReturn]]>
                    </bpel:query>
                </bpel:from>
				<bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:推荐酒店]]>
                    </bpel:query>
                </bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="parameters" variable="rentalCarResponse">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[ns4:getRentalCarReturn]]>
                    </bpel:query>
                </bpel:from>
				<bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:推荐租车]]>
                    </bpel:query>
                </bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="parameters" variable="tourResponse">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[ns1:getTourReturn]]>
                    </bpel:query>
                </bpel:from>
				<bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:推荐导游]]>
                    </bpel:query>
                </bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="parameters" variable="spotResponse">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[ns1:getSpotReturn]]>
                    </bpel:query>
                </bpel:from>
				<bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:推荐景点]]>
                    </bpel:query>
                </bpel:to>
			</bpel:copy>
			
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:总预算]]></bpel:query>
                </bpel:from>
                <bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:剩余预算]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            
            <bpel:copy>
                <bpel:from part="parameters" variable="hotelPriceResponse">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns2:getHotelPriceReturn]]></bpel:query>
                </bpel:from>
                <bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:酒店预算]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="parameters" variable="ticketPriceResponse">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:getTicketPriceReturn]]></bpel:query>
                </bpel:from>
                <bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:机票预算]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="parameters" variable="rentalCarPriceResponse">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns4:getRentalCarPriceReturn]]></bpel:query>
                </bpel:from>
                <bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:租车预算]]></bpel:query>
                </bpel:to>
            </bpel:copy>
        </bpel:assign>
		<bpel:reply name="replyOutput" partnerLink="client"
			portType="tns:TravelProcess" operation="process" variable="output" />
	</bpel:sequence>
</bpel:process>

